# DynDNS Server

This is a simple DynDNS-Server based on [BIND](https://www.isc.org/software/bind/).
 
### Start the server

```
docker run -d -p 53:53/udp -p <update port>:8080/tcp -v <data folder>:/data thackba/dyndns-bind:latest
```

If the container is running you can update domains with the following HTTP-call:
```
http://<server>:<update port>/update?parameter
```

Here you can find a list of the know parameter:

- domain - the domain to update
- username - the user. see 'settings.json'
- password - the password for the user. see 'settings.json'
- ip4addr - the IP V4 address to set
- ip6addr - the IP V6 address to set

Only the first three parameter are mandatory. 

###### Sample:

```
http://server:8080/update?domain=server.example.domain&username=username&password=a-secure-password&ipv4addr=10.2.1.2
```

### Configuration

The `data folder have to contain the following files:

- dyndns.key
- dyndns.zones
- settings.json

The data folder also have to contain a folder named "`cache`".
This folder will contain the zone files for the configured zones. 

#### dyndns.key

This file contains the key used for a `nsupdate` call.

###### Sample:

```
key "ddns-key" {
  algorithm hmac-sha256;
  secret "secret generated by the tool ddns-confgen";
};
```

#### dyndns.zones

This file contains the zone definitions. It also has to contains the key of the file above. 

###### Sample:

```
key "ddns-key" {
  algorithm hmac-sha256;
  secret "secret generated by the tool ddns-confgen";
};

zone "example.domain" in {
  type master;
  file "example.domain.zone";
  update-policy {
    grant ddns-key zonesub ANY;
  };
};
```

#### settings.json

The settings file of the DynDNS server.

###### Sample:

```
{
  "sites": {
    "server.example.domain": {
      "host": "server",
      "zone": "example.domain",
      "username": "username",
      "password_salt": "password part generate by the the dyndns-generate-password",
      "password_key": "password part generate by the the dyndns-generate-password"
    }
  }
}

```

#### The zone files

The zone files are default BIND zone files. Please take a look in the BIND documentation.

###### Sample:

```
$ORIGIN .
$TTL 60	; 1 minute
example.domain		IN SOA	ns0.example.domain. mail.example.domain. (
   3          ; serial
   7200       ; refresh (2 hours)
   1800       ; retry (30 minutes)
   604800     ; expire (1 week)
   21600      ; minimum (6 hours)
)
NS ns0.example.domain.
$ORIGIN texample.domain.
ns0      A    1.2.2.4
server   A    1.2.3.4
         AAAA    2001:db8::6


```

#### Tools

###### Generate secret for dyndns.* files

```
docker run --rm thackba/dyndns-bind:latest ddns-confgen
```


###### Generate password for the settings

```
docker run --rm thackba/dyndns-bind:latest python3 /dyndns-generate-password.py a-secure-password
```
